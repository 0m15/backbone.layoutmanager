(function(a,b,c){"use strict";var d=a.LayoutManager=a.View.extend({initialize:function(){var c,d,e={},f=this;b.isFunction(this.options.views)?(b.extend(e,this.options.views.call(this)),delete this.options.views):b.isObject(this.options.views)&&(b.extend(e,this.options.views),delete this.options.views),this.views={},b.each(e,function(a,b){f.view(b,a)}),this.options=b.extend({},a.LayoutManager,this.options),b.isFunction(this.options.initialize)&&this.options.initialize.apply(this,arguments),b.bindAll(this)},view:function(a,c){function g(a){var b=f.deferred();return b.async=function(){return b._isAsync=!0,a},b.partial=f.deferred(),b}function h(a){function l(b,e){d.cache(c,e),f.html(a.el,f.render.call(f,e,b)),h.partial.resolve(a.el),j(a,a.views)}var c,h,i,k;return{insert:function(b,c){var d=a.views=a.views||{},e=d[b]=d[b]||[];return e.push(c),c},render:function(j){return!j&&b.isFunction(a.serialize)?j=a.serialize.call(a):!j&&b.isObject(a.serialize)&&(j=a.serialize),h=g(b.bind(l,e,j)),i=f.paths&&f.paths.template||"",b.isString(a.template)&&(c=i+a.template),(k=d.cache(c))?(l(j,k,c),h):(b.isString(a.template)?k=f.fetch.call(h,i+a.template):k=f.fetch.call(h,a.template),h._isAsync||l(j,k),h)}}}function i(a,c,d){var e=d.render;return function(){var g=e.call(d,h);g.partial.then(function(e){f.partial(a.el,c,e,d.options.append),g.resolve(a.el);if(b.isObject(d.options.views))return j(d,d.options.views)}),d.delegateEvents()}}function j(a,c){function d(b,c){var d=b.render;b.render._wrapped||(b.render=i(a,c,b),b.render._wrapped=!0),b.render()}b.each(c,function(a,c){if(b.isArray(a))return b.each(a,function(a){a.options.append=!0,d(a,c)});d(a,c)})}var e=this,f=this.options;return c.render._wrapped||(c.render=i(e,a,c),c.render._wrapped=!0),this.views[a]=c},render:function(a){function j(a){var b=i.deferred();return b.async=function(){return b._isAsync=!0,a},b.partial=i.deferred(),b}function k(c){var e={};d.cache(f,c),b.isFunction(i.serialize)?e=i.serialize.call(h):b.isObject(i.serialize)&&(e=i.serialize),i.html(h.el,i.render.call(i,c,e)),b.each(h.views,function(a){a.render()}),a(h.el)}var c,e,f,g,h=this,i=this.options;e=i.paths&&i.paths.layout||"",b.isString(i.template)?f=e+i.template:f=i.template;if(c=d.cache(f))return k(c);g=j(k),c=i.fetch.call(g,f);if(!g._isAsync)return k(c)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(c){var d=a.LayoutManager.prototype.options;b.isObject(c)&&b.extend(d,c)},View:a.View.extend({render:function(a){return a(this).render()}})});a.LayoutManager.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return c(a).html()},partial:function(a,b,d,e){e?this.append(c(a).find(b),d):this.html(c(a).find(b),d)},html:function(a,b){c(a).html(b)},append:function(a,b){c(a).append(b)},render:function(a,c){return b.template(a)(c)}}})(this.Backbone,this._,this.jQuery)