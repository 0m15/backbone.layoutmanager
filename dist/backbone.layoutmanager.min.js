/* backbone.layoutmanager.js v0.0.3
 * Copyright 2011, Tim Branyen (@tbranyen)
 * backbone.layoutmanager.js may be freely distributed under the MIT license.
 */(function(a,b,c){"use strict";var d=a.LayoutManager=a.View.extend({initialize:function(){var c,d,e={};b.isFunction(this.options.views)?(b.extend(e,this.options.views.call(this)),delete this.options.views):b.isObject(this.options.views)&&(b.extend(e,this.options.views),delete this.options.views),this.views=e,this.options=b.extend({},a.LayoutManager,this.options),b.isFunction(this.options.initialize)&&this.options.initialize.apply(this,arguments),b.bindAll(this)},render:function(a){function i(a){var b=h.deferred();return b.async=function(){return a},b.partial=h.deferred(),b}function j(a){function f(b,c){d.cache(j,c),a.el.innerHTML=h.render.call(h,c,b),k.partial.resolve(a.el)}var j,k;return{render:function(l){return!l&&b.isFunction(a.serialize)?l=a.serialize.call(a):!l&&b.isObject(a.serialize)&&(l=a.serialize),k=i(b.bind(f,g,l)),e=h.paths&&h.paths.template||"",j=e+a.template,(c=d.cache(j))?(f(l,c,j),k):(c=h.fetch.call(k,e+a.template),c&&f(l,c),k)}}}function k(c){function i(a,c){b.each(c,function(c,d){var e=c.render;c.render=function(){var f=e.call(c,j);f.partial.then(function(e){h.partial(a.el,d,e),f.resolve(a.el);if(b.isObject(c.options.views))return i(c,c.options.views)}),c.delegateEvents()},c.render()})}var e={};d.cache(f,c),b.isObject(h.serialize)?e=h.serialize:b.isFunction(h.serialize)&&(e=h.serialize.call(g)),g.el.innerHTML=h.render.call(h,c,e),i(g,g.views),a(g.el)}var c,e,f,g=this,h=this.options;e=h.paths&&h.paths.layout||"",f=e+h.template;if(c=d.cache(f))return k(c);c=h.fetch.call(i(k),f);if(c)return k(c)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(c){var d=a.LayoutManager.prototype.options;b.isObject(c)&&b.extend(d,c)},View:a.View.extend({render:function(a){return a(this).render()}})});a.LayoutManager.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return c(a).html()},partial:function(a,b,d){c(a).find(b).html(d)},render:function(a,c){return b.template(a)(c)}}}).call(this,this.Backbone,this._,this.jQuery)