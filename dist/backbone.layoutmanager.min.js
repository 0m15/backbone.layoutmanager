/* backbone.layoutmanager.js v0.0.1
 * Copyright 2011, Tim Branyen (@tbranyen)
 * backbone.layoutmanager.js may be freely distributed under the MIT license.
 */(function(a,b,c){"use strict";var d=a.LayoutManager=a.View.extend({initialize:function(){var c={};b.isFunction(this.options.views)?(b.extend(c,this.options.views.call(this)),delete this.options.views):b.isObject(this.options.views)&&(b.extend(c,this.options.views),delete this.options.views),this.views=c,this.options=b.extend({},a.LayoutManager,this.options),this.layout=undefined,b.isFunction(this.options.initialize)&&this.options.initialize.apply(this,arguments),b.bindAll(this)},render:function(a){function k(c){d.cache(f,c);if(!g.layout||g.layout!==f)g.el.innerHTML=c;b.each(g.views,function(a,b){a.render(j).then(function(a){h.partial(g.el,b,a)})}),a(g.el),g.layout=f}function j(a){function f(b,c){d.cache(j,c),a.el.innerHTML=h.render.call(h,c,b),k.resolve(a.el)}var j,k;return{render:function(l){!l&&b.isFunction(a.serialize)&&(l=a.serialize.call(a)),k=i(b.bind(f,g,l)),e=h.paths&&h.paths.template||"",j=e+a.template;if(c=d.cache(j)){f(l,c,j);return k}c=h.fetch.call(k,e+a.template),c&&f(l,c);return k}}}function i(a){var b=h.deferred();b.async=function(){return a};return b}var c,e,f,g=this,h=this.options;e=h.paths&&h.paths.layout||"",f=e+h.name;if(c=d.cache(f))return k(c);c=h.fetch.call(i(k),f);if(c)return k(c)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(c){var d=a.LayoutManager.prototype.options;b.isObject(c)&&b.extend(d,c)},View:a.View.extend({render:function(a){return a(this).render()}})});a.LayoutManager.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return c(a).html()},partial:function(a,b,d){c(a).find(b).html(d)},render:function(a,c){return b.template(a)(c)}}}).call(this,this.Backbone,this._,this.jQuery)