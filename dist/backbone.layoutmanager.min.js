/* backbone.layoutmanager.js v0.0.4
 * Copyright 2011, Tim Branyen (@tbranyen)
 * backbone.layoutmanager.js may be freely distributed under the MIT license.
 */(function(a,b,c){"use strict";var d=a.LayoutManager=a.View.extend({initialize:function(){var c,d,e={},f=this;b.isFunction(this.options.views)?(b.extend(e,this.options.views.call(this)),delete this.options.views):b.isObject(this.options.views)&&(b.extend(e,this.options.views),delete this.options.views),this.views={},b.each(e,function(a,b){f.view(b,a)}),this.options=b.extend({},a.LayoutManager,this.options),b.isFunction(this.options.initialize)&&this.options.initialize.apply(this,arguments),b.bindAll(this)},view:function(a,c){function j(a,c){b.each(c,function(b,c){var d=b.render;b.render=i(a,c,b),b.render()})}function i(a,c,d){var e=d.render;return function(){var g=e.call(d,h);g.partial.then(function(e){f.partial(a.el,c,e),g.resolve(a.el);if(b.isObject(d.options.views))return j(d,d.options.views)}),d.delegateEvents()}}function h(a){function k(b,e){d.cache(c,e),a.el.innerHTML=f.render.call(f,e,b),h.partial.resolve(a.el)}var c,h,i,j;return{render:function(l){!l&&b.isFunction(a.serialize)?l=a.serialize.call(a):!l&&b.isObject(a.serialize)&&(l=a.serialize),h=g(b.bind(k,e,l)),i=f.paths&&f.paths.template||"",b.isString(a.template)&&(c=i+a.template);if(j=d.cache(c)){k(l,j,c);return h}b.isString(a.template)?j=f.fetch.call(h,i+a.template):j=f.fetch.call(h,a.template),j&&k(l,j);return h}}}function g(a){var b=f.deferred();b.async=function(){return a},b.partial=f.deferred();return b}var e=this,f=this.options;c.render=i(e,a,c),this.views[a]=c},render:function(a){function j(c){var e={};d.cache(f,c),b.isObject(h.serialize)?e=h.serialize:b.isFunction(h.serialize)&&(e=h.serialize.call(g)),g.el.innerHTML=h.render.call(h,c,e),b.each(g.views,function(a){a.render()}),a(g.el)}function i(a){var b=h.deferred();b.async=function(){return a},b.partial=h.deferred();return b}var c,e,f,g=this,h=this.options;e=h.paths&&h.paths.layout||"",b.isString(h.template)?f=e+h.template:f=h.template;if(c=d.cache(f))return j(c);c=h.fetch.call(i(j),f);if(c)return j(c)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(c){var d=a.LayoutManager.prototype.options;b.isObject(c)&&b.extend(d,c)},View:a.View.extend({render:function(a){return a(this).render()}})});a.LayoutManager.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return c(a).html()},partial:function(a,b,d){c(a).find(b).html(d)},render:function(a,c){return b.template(a)(c)}}}).call(this,this.Backbone,this._,this.jQuery)