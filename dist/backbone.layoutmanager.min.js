(function(a,b,c){function d(a){function h(b,d){e.cache(c,d),g.html(a.el,g.render(d,b)),f.resolve(a.el)}var c,d,f,g=a._options();return{insert:function(b,c){return a.view(b,c,!0)},render:function(i){var j=a.template||g.template;return a.serialize&&(g.serialize=a.serialize),!i&&b.isFunction(g.serialize)?i=g.serialize.call(a):!i&&b.isObject(g.serialize)&&(i=g.serialize),f=e.makeAsync(g,b.bind(h,a,i)),b.isString(j)&&(c=a._prefix+j),(d=e.cache(c))?(setTimeout(function(){h(i,d,c)},0),f):(b.isString(j)?d=g.fetch.call(f,a._prefix+j):d=g.fetch.call(f,j),f._isAsync||setTimeout(function(){h(i,d)},0),f)}}}"use strict";var e=a.View.extend({__manager__:{},constructor:function(c){var d=a.LayoutManager.prototype;c=b.extend({},d.options,c),this._render=function(a){return a(this).render()},this.views={},this.render!==d.render&&(this._render=this.render,this.render=d.render),c.paths&&(this._prefix=c.paths.layout||""),c.views&&this.setViews(c.views),a.View.call(this,c)},setViews:function(a){b.each(a,function(a,b){this.view(b,a)},this)},view:function(c,d,f){var g,h,i=this;return d.__manager__={},d instanceof e||(d._render=d.render,d.render===a.View.prototype.render&&(d._render=function(a){return a(this).render()}),d.views&&(d.options.views=d.views),b.extend(d,{views:{},view:e.prototype.view,setViews:e.prototype.setViews,_options:e.prototype._options})),f||(d.__manager__.isManaged=!0),d.render=function(a){var b=h.deferred();return d.__manager__.isManaged?(e.prototype.render.call(d).then(function(){d.__manager__.hasRendered||(h.partial(i.el,c,d.el,f),d.__manager__.hasRendered=!0),d.delegateEvents(),b.resolve(d.el)}),b.promise()):b.resolve(d.el)},h=d._options(),h.paths&&(d._prefix=h.paths.template||""),h.views&&d.setViews(h.views),f?(g=this.views[c]=this.views[c]||[],g.push(d),d):this.views[c]=d},render:function(a){var c=this,e=this._options(),f=e.deferred();return this._render(d).then(function(){c.__manager__.hasRendered||e.detach(c.el);var a=b.map(c.views,function(a){function d(a,b){if(!a.length)return b();var c=a.shift();c.__manager__.isManaged=!0,c.render().then(function(){d(a,b)})}var c;return b.isArray(a)?(c=e.deferred(),d(b.clone(a),function(){c.resolve()}),c.promise()):(a.__manager__.isManaged=!0,a.render())});e.when(a).then(function(){f.resolve(c.el)})}),f.then(function(d){c.delegateEvents(),b.isFunction(a)&&a(c.el)}).promise()},_options:function(){return b.extend({},e.prototype.options,this.options)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(a){b.isObject(a)&&b.extend(e.prototype.options,a)},makeAsync:function(a,b){var c=a.deferred();return c.async=function(){return c._isAsync=!0,b},c}});a.LayoutManager=e,a.LayoutManager.View=e,e.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return b.template(c(a).html())},partial:function(a,b,d,e){var f=c(a).find(b);this[e?"append":"html"](f,d)},html:function(a,b){c(a).html(b)},append:function(a,b){c(a).append(b)},detach:function(a){c(a).detach()},when:function(a){return c.when.apply(null,a)},render:function(a,b){return a(b)}}})(this.Backbone,this._,this.jQuery)