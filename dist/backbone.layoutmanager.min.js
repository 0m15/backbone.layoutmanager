(function(a,b,c){function d(a){function h(b,d){f.cache(c,d),g.html(a.el,g.render(d,b)),e.resolve(a.el)}var c,d,e,g=a._options();return{insert:function(b,c){return a.view(b,c,!0)},render:function(i){var j=a.template||g.template;return a.serialize&&(g.serialize=a.serialize),!i&&b.isFunction(g.serialize)?i=g.serialize.call(a):!i&&b.isObject(g.serialize)&&(i=g.serialize),e=f.makeAsync(g,b.bind(h,a,i)),b.isString(j)&&(c=a._prefix+j),(d=f.cache(c))?(setTimeout(function(){h(i,d,c)},0),e):(b.isString(j)?d=g.fetch.call(e,a._prefix+j):d=g.fetch.call(e,j),e._isAsync||setTimeout(function(){h(i,d)},0),e)}}}function e(c){var d=a.LayoutManager.prototype;c=b.extend({},d.options,c),this.render!==d.render?(this._render=this.render,this.render=d.render):this._render=function(a){return a(this).render()},c.paths&&(this._prefix=c.paths.layout||""),this.views={},c.views&&this.setViews(c.views),a.View.apply(this,arguments)}"use strict";var f=a.View.extend({constructor:e,setViews:function(a){b.each(a,function(a,b){this.view(b,a)},this)},view:function(b,c,d){var e,g,h=this;return c instanceof f||(c.render===a.View.prototype.render?c._render=function(a){return a(this).render()}:c._render=c.render,c.views&&(c.options.views=c.views),c.views={},c.view=f.prototype.view,c.setViews=f.prototype.setViews,c._options=f.prototype._options),c.render=function(a){return f.prototype.render.call(c).then(function(){g.partial(h.el,b,c.el,d),c.delegateEvents()})},g=c._options(),g.paths&&(c._prefix=g.paths.template||""),g.views&&c.setViews(g.views),d?(e=this.views[b]=this.views[b]||[],e.push(c),c):this.views[b]=c},render:function(a){var c=this,e=this._options(),f=e.deferred();return this._render(d).then(function(){e.detach(c.el);var a=b.map(c.hasOwnProperty("views")&&c.views,function(a){function f(a,b){if(!a.length)return b();var c=a.shift();c.render().then(function(){f(a,b)})}var c,d;return b.isArray(a)&&a.length?(d=b.clone(a),c=e.deferred(),f(d,function(){c.resolve()}),c.promise()):a.render()});e.when(a).then(function(){f.resolve()})}),f.then(function(d){c.delegateEvents(),b.isFunction(a)&&a(c.el)}).promise()},_options:function(){return b.extend({},f.prototype.options,this.options)}},{_cache:{},cache:function(a,b){if(a in this._cache)return this._cache[a];if(a!=null&&b!=null)return this._cache[a]=b},configure:function(a){b.isObject(a)&&b.extend(f.prototype.options,a)},makeAsync:function(a,b){var c=a.deferred();return c.async=function(){return c._isAsync=!0,b},c}});a.LayoutManager=f,a.LayoutManager.View=f,f.prototype.options={paths:{},deferred:function(){return c.Deferred()},fetch:function(a){return b.template(c(a).html())},partial:function(a,b,d,e){var f=c(a).find(b);this[e?"append":"html"](f,d)},html:function(a,b){c(a).html(b)},append:function(a,b){c(a).append(b)},detach:function(a){c(a).detach()},when:function(a){return c.when.apply(null,a)},render:function(a,b){return a(b)}}})(this.Backbone,this._,this.jQuery)