<!doctype html>
<html lang=en>
<head>
  <meta charset=utf-8>
  <meta http-equiv=X-UA-Compatible content=IE=edge,chrome=1>

  <title>Horribly unfinished proof-of-concept</title>
</head>

<body>
  <!-- Layout -->
  <script id="base" type="template">
    <marquee class="main"></marquee>
  </script>

  <!-- Template -->
  <script id="main" type="template">
    testing
  </script>

  <div id="container"></div>
  
  <script src=js/libs/jquery.js></script>
  <script src=js/libs/underscore.js></script>
  <script src=js/libs/backbone.js></script>
  <script src=backbone.layoutmanager.js></script>
  <script>
    // Secondary view without LayoutManager
    // very little work needed to get going.
    var MainView = Backbone.View.extend({
      // This is optional, using a serialize function to maintain consistency
      serialize: function() {
        return {};
      },

      // Define template here
      template: "#main",

      // Very simple to implement here
      render: function(layout) {
        // Defer to the LayoutManager to marry the template to the view with
        // the context object passed into the render method.
        // return layout(this).render(this.serialize());

        // Omission of a context object defers to the serialize function.
        // So this would be functionally equivalent to the return statement above.
        return layout(this).render();
      }
    });

    // Create a new Element instance of the layout, DIV by default just like
    // Backbone, with an identical matching tagName to create a custom type.
    var baseLayout = new Backbone.LayoutManager({ name: "#base",
      // Add in a compile step that will be called automatically, when template
      // is fetched.
      compile: function(contents) {
        return this.engine(contents);
      },

      // Handling partials
      partial: function(layout, name, template) {
        var container = $("<div/>").html(layout);

        console.log(this, arguments);

        container.find(name).html(template);

        return container.html();
      },

      render: function(template, context) {
        return template(context);
      },

      // Fetch the template, interally uses AJAX
      fetch: function(path) {
        var done = this.async();
        done($(path).html());
      },

      engine: _.template
    });

    // MainView already knows what template to use since we defined it in the
    // definition.
    var mainView = new MainView();

    // Attach a partial view outside of the initializer
    baseLayout.partials[".main"] = mainView;

    // Insert into the DOM
    baseLayout.render(function(contents) {
      $("#container").html(contents);
    });
  </script>
</body>
</html>
